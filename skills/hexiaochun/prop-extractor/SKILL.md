---
name: prop-extractor
description: 从剧本中提取关键道具（武器、信物、法宝等），生成道具风格卡。当需要提取道具、建立道具库、生成道具描述时使用。
---

# 道具提取器

从剧本中提取关键道具，生成道具风格卡，确保道具跨镜头视觉一致。

## 核心原则

- **关键道具优先**：只提取剧情相关的重要道具，忽略普通背景物品
- **归属明确**：每个道具必须明确归属角色或场景
- **PropKey 唯一**：每个道具必须有唯一 Key，供镜头表引用

## 输入要求

### 必填
- **剧本正文**：包含道具描写、使用场景
- **STYLE_BASE**：风格锚点

### 可选
- **角色卡列表**：用于关联道具归属
- **道具参考图**：用于锁定外形细节

## 道具分类

| 类型 | 说明 | 示例 |
|------|------|------|
| 武器 | 攻击/防御用具 | 剑、刀、弓、盾 |
| 信物 | 情感/身份象征 | 玉佩、戒指、信笺 |
| 法宝 | 特殊能力物品 | 仙丹、符咒、法器 |
| 容器 | 装载物品的器具 | 酒壶、药瓶、宝箱 |
| 日用 | 日常使用物品 | 书籍、乐器、工具 |
| 线索 | 推动剧情的物品 | 地图、密信、证据 |

## 提取流程

### 步骤 1：扫描剧本道具

识别剧本中出现的道具：
- 台词提及的物品
- 动作描述中的物品
- 镜头描述中的特写物品
- 系统奖励/获得的物品

### 步骤 2：筛选关键道具

保留符合以下条件的道具：
- 多次出现
- 推动剧情
- 角色标志性物品
- 有特写镜头
- 有情感意义

### 步骤 3：分析道具信息

对每个道具提取：
- 名称
- 类型
- 归属角色
- 外观描述
- 剧情意义
- 使用场景

### 步骤 4：生成道具风格卡

按标准格式输出。

## 输出格式

### 道具风格卡

```text
## {道具名} (PropKey: {prop_key})

- **PropKey：**prop_{项目}_{道具拼音}
- **道具名：**{道具名称}
- **类型：**{武器/信物/法宝/容器/日用/线索}
- **归属角色：**@{角色ID}（或"无归属/公共道具"）

### 外观描述
- 材质：{金属/玉石/木质/布料等}
- 颜色：{主色/配色/发光效果}
- 尺寸：{具体尺寸或相对大小}
- 装饰：{纹样/雕刻/镶嵌}
- 特效：{发光/飘动/雾气等}

### 剧情意义
- {意义1：如"身份象征"}
- {意义2：如"情感寄托"}
- {意义3：如"关键线索"}

### 使用场景
- {场景1：如"1-1 妖兽谷战斗"}
- {场景2：如"2-3 赠送信物"}

### 道具提示词（供图像生成）
{STYLE_BASE}，{道具完整描述}，白色背景，物品特写，居中构图，高清细节，无人物
```

## PropKey 命名规范

### 格式
```
prop_{项目缩写}_{道具拼音或英文}
```

### 示例
- `prop_jl_qingfengjian` - 剑来-青锋剑
- `prop_jl_yupei` - 剑来-玉佩
- `prop_dushi_hetong` - 都市-合同
- `prop_cbpk_qiangnao` - 赛博朋克-枪脑接口

## 道具类型模板

### 武器类
```text
## 青锋剑 (PropKey: prop_jl_qingfengjian)

- **PropKey：**prop_jl_qingfengjian
- **道具名：**青锋剑
- **类型：**武器
- **归属角色：**@jl_chenfeng

### 外观描述
- 材质：寒铁锻造，剑身泛青光
- 颜色：青蓝色剑身，银白剑锋
- 尺寸：三尺三寸，标准长剑
- 装饰：剑柄缠白色丝带，剑穗飘逸
- 特效：出鞘时剑身隐有青光流转

### 剧情意义
- 陈风的本命兵器
- 师门传承信物
- 实力象征

### 使用场景
- 1-1 妖兽谷战斗
- 2-5 剑道比试
- 3-2 斩杀妖王

### 道具提示词
2.5D国风动画，青绿山水色调，细腻工笔材质，青锋剑，寒铁锻造，青蓝色剑身，银白剑锋，三尺三寸长剑，剑柄缠白色丝带，剑穗飘逸，剑身青光流转，白色背景，物品特写，居中构图，高清细节，无人物
```

### 信物类
```text
## 鸳鸯玉佩 (PropKey: prop_jl_yuanyangpei)

- **PropKey：**prop_jl_yuanyangpei
- **道具名：**鸳鸯玉佩
- **类型：**信物
- **归属角色：**@jl_chenfeng / @jl_ningyu（一对）

### 外观描述
- 材质：羊脂白玉，温润细腻
- 颜色：乳白色，微泛暖光
- 尺寸：成人拇指大小，可握于掌心
- 装饰：雕刻鸳鸯图案，一雄一雌
- 特效：双玉靠近时微微发光

### 剧情意义
- 定情信物
- 身份凭证
- 情感羁绊象征

### 使用场景
- 1-8 定情赠玉
- 3-1 凭玉相认
- 5-5 生死诀别

### 道具提示词
2.5D国风动画，青绿山水色调，细腻工笔材质，鸳鸯玉佩，羊脂白玉，温润细腻，乳白色微泛暖光，拇指大小，雕刻鸳鸯图案，精致古朴，白色背景，物品特写，居中构图，高清细节，无人物
```

### 法宝类
```text
## 聚气丹 (PropKey: prop_jl_juqidan)

- **PropKey：**prop_jl_juqidan
- **道具名：**聚气丹
- **类型：**法宝
- **归属角色：**无归属/消耗品

### 外观描述
- 材质：灵药炼制，表面光滑
- 颜色：琥珀色，半透明，内有流光
- 尺寸：龙眼大小，圆润饱满
- 装饰：无
- 特效：服用时化作光点融入体内

### 剧情意义
- 修炼资源
- 系统奖励常见物品
- 实力提升途径

### 使用场景
- 1-2 首次获得
- 2-1 批量服用
- 3-3 交易货币

### 道具提示词
2.5D国风动画，青绿山水色调，细腻工笔材质，聚气丹，灵药丹丸，琥珀色半透明，龙眼大小，圆润饱满，内有流光流转，白色背景，物品特写，居中构图，高清细节，无人物
```

### 线索类
```text
## 藏宝图 (PropKey: prop_jl_cangbaotu)

- **PropKey：**prop_jl_cangbaotu
- **道具名：**藏宝图
- **类型：**线索
- **归属角色：**@jl_chenfeng

### 外观描述
- 材质：泛黄羊皮纸，边缘破损
- 颜色：暗黄底色，墨色图案
- 尺寸：展开约一尺见方
- 装饰：红色标记点，神秘符文
- 特效：特定条件下符文发光

### 剧情意义
- 主线剧情关键道具
- 引出新地图
- 宝藏位置线索

### 使用场景
- 1-5 意外获得
- 2-2 研究解读
- 4-1 找到宝藏

### 道具提示词
2.5D国风动画，青绿山水色调，细腻工笔材质，藏宝图，泛黄羊皮纸，边缘破损，暗黄底色，墨色山川图案，红色标记点，神秘符文，古朴沧桑，白色背景，物品特写，居中构图，高清细节，无人物
```

## 输出汇总格式

```text
# 道具资产清单

## 项目信息
- 项目名：{项目名}
- STYLE_BASE_ID：{风格ID}
- 道具总数：{数量}

## 武器类
{武器道具卡1}
{武器道具卡2}
...

## 信物类
{信物道具卡1}
...

## 法宝类
{法宝道具卡1}
...

## 其他道具
{其他道具卡}
...

## 道具索引
| 道具名 | PropKey | 类型 | 归属角色 | 出现场次 |
|--------|---------|------|----------|----------|
| 青锋剑 | prop_jl_qingfengjian | 武器 | @jl_chenfeng | 1-1,2-5,3-2 |
| 鸳鸯玉佩 | prop_jl_yuanyangpei | 信物 | @jl_chenfeng | 1-8,3-1,5-5 |
| ... | ... | ... | ... | ... |
```

## 质量检查

生成后必须自检：
- [ ] 是否所有道具都有唯一 PropKey？
- [ ] 外观描述是否足够具体可视化？
- [ ] 归属角色是否使用正确的角色 ID？
- [ ] 剧情意义是否明确？
- [ ] 道具提示词是否可直接用于生图？

## HTML 展示输出

### 必须输出

完成道具提取和图片生成后，**必须**生成 HTML 展示页面。

### 模板位置

```
assets/templates/gallery.html
```

### 输出文件命名

```
{项目名}_道具展示.html
```

保存到与资产清单相同的目录。

### 占位符替换

| 占位符 | 替换内容 | 示例 |
|--------|----------|------|
| `{{PROJECT_NAME}}` | 项目名称 | 剑来 |
| `{{TOTAL_COUNT}}` | 道具总数 | 10 |
| `{{STYLE_BASE}}` | 风格基准名称 | 国风仙侠 |
| `{{GALLERY_SECTIONS}}` | 分组HTML（见下方格式） | - |
| `{{PROP_DATA_JSON}}` | 道具数据JSON对象 | - |
| `{{GENERATED_TIME}}` | 生成时间 | 2026-02-02 |

### 分组 HTML 格式

```html
<section class="gallery-section">
    <div class="gallery-section-header">
        <h2 class="gallery-section-title">信物类</h2>
        <span class="gallery-section-count">3件</span>
    </div>
    <div class="gallery-grid">
        <div class="gallery-card" onclick="openLightbox('prop_jl_jinhuangliyu')">
            <div class="gallery-card-image">
                <img src="{图片URL}" alt="金黄鲤鱼">
                <span class="gallery-card-tag token">信物</span>
            </div>
            <div class="gallery-card-info">
                <h3 class="gallery-card-name">金黄鲤鱼</h3>
                <p class="gallery-card-id">prop_jl_jinhuangliyu</p>
                <p class="gallery-card-owner">归属：@jl_jinyishaonian</p>
            </div>
        </div>
        <!-- 更多道具卡片 -->
    </div>
</section>
```

### 道具类型对应 CSS 类

| 类型 | CSS类 |
|------|-------|
| 武器 | `weapon` |
| 信物 | `token` |
| 法宝 | `magic` |
| 日用 | `daily` |
| 线索 | `clue` |

### 道具数据 JSON 格式

```javascript
{
    "prop_jl_jinhuangliyu": {
        "name": "金黄鲤鱼",
        "id": "prop_jl_jinhuangliyu",
        "type": "信物/线索",
        "owner": "@jl_jinyishaonian",
        "image": "{图片URL}",
        "appearance": "通体金黄，鳞片闪亮如镀金，巴掌大小...",
        "meaning": "引出锦衣少年与陈平安的交集，暗示身份不凡",
        "scenes": "1-4【闪回】, 1-4"
    },
    // 更多道具...
}
```

### 生成后操作

1. 保存 HTML 文件
2. 使用 `open {文件路径}` 命令在浏览器中打开展示

## 额外资源

- 道具描述规则：[format-rules.md](references/format-rules.md)
- HTML模板：[gallery.html](assets/templates/gallery.html)
