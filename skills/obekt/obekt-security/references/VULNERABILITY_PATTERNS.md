# Vulnerability Patterns Catalog

Complete catalog of security vulnerability patterns detected by obekt-security.

## Critical Severity

### Command Injection

**Pattern Code:** `critical:command_injection`

**Patterns:**
- `exec()` with user input
- `eval()` with user input
- `os.system()` with user input
- `subprocess` with `shell=True`

**Why Critical:** Allows arbitrary code execution on the host system. Attackers can gain full system control.

**Examples:**
```python
# BAD: User input directly in exec
user_input = request.GET.get('command')
exec(user_input)

# BAD: Shell=True with concatenation
os.system("mkdir " + user_path)

# BAD: subprocess with shell=True
subprocess.call("ls " + user_dir, shell=True)
```

### SQL Injection

**Pattern Code:** `critical:sql_injection`

**Patterns:**
- SQL queries with string concatenation
- SQL queries with f-strings
- Direct user input in SQL statements

**Why Critical:** Allows database manipulation, data exfiltration, authentication bypass.

**Examples:**
```python
# BAD: String concatenation
cursor.execute("SELECT * FROM users WHERE id = " + user_id)

# BAD: F-string interpolation
query = f"SELECT * FROM users WHERE name = '{username}'"
cursor.execute(query)

# GOOD: Parameterized query
cursor.execute("SELECT * FROM users WHERE id = %s", (user_id,))
```

### Crypto Wallet Drain

**Pattern Code:** `critical:crypto_drain`

**Patterns:**
- Hardcoded mnemonic phrases
- Hardcoded private keys
- Hardcoded wallet seeds

**Why Critical:** Permanent loss of cryptocurrency assets. Secrets cannot be recovered if exposed.

**Examples:**
```python
# CRITICAL: Never hardcode wallet secrets
mnemonic = "word1 word2 word3 ..."
private_key = "0xabc123..."
```

**Detection:**
- 12-24 word BIP39 phrases
- 64-character hex strings (Ethereum private keys)
- PEM key blocks (BEGIN PRIVATE KEY)

---

## High Severity

### Hardcoded Secrets

**Pattern Code:** `high:hardcoded_secrets`

**Patterns:**
- API keys
- Secret keys
- Passwords
- Access tokens
- Service account keys

**Why High:** Credentials allow unauthorized access to external services.

**Examples:**
```python
# BAD: Hardcoded API key
API_KEY = "sk_live_51AbCdEf123456"

# GOOD: Use environment variables
import os
API_KEY = os.getenv('API_KEY')
```

### Weak Cryptography

**Pattern Code:** `high:weak_crypto`

**Patterns:**
- MD5 hash
- SHA1 hash
- DES cipher
- RC4 cipher

**Why High:** These algorithms are broken and can be cracked easily.

**Alternatives:**
- Hashing: SHA-256, SHA-512, bcrypt, argon2
- Encryption: AES-256-GCM, ChaCha20-Poly1305

### Path Traversal

**Pattern Code:** `high:file_traversal`

**Patterns:**
- Path construction with `..`
- User-controlled file paths
- Missing path validation

**Why High:** Allows reading files outside the intended directory, accessing sensitive system files.

**Examples:**
```python
# BAD: User controls path
file_path = "/var/data/" + request.GET['file']
open(file_path, 'r')

# GOOD: Validate and sanitize
import os
base_dir = "/var/data"
filename = os.path.basename(request.GET['file'])
file_path = os.path.join(base_dir, filename)
```

### Weak Random Numbers

**Pattern Code:** `high:weak_random`

**Patterns:**
- `random.random()`
- `random.randint()`
- `math.random()`

**Why High:** Predictable numbers compromise cryptographic operations, session tokens, and randomness requirements.

**Alternatives:**
- `secrets` module for cryptographic operations
- `os.urandom()` for system random bytes
- `random.SystemRandom()` for system randomness

---

## Medium Severity

### Information Leakage

**Pattern Code:** `medium:info_leakage`

**Patterns:**
- Passwords in logs
- Tokens in debug output
- Keys in print statements

**Why Medium:** Exposes sensitive data in logs, potentially accessible by attackers.

**Examples:**
```python
# BAD
print(f"User logged in: {user.email}, password: {user.password}")

# GOOD
print(f"User logged in: {user.email}")
```

### Unsafe Redirects

**Pattern Code:** `medium:unsafe_redirect`

**Patterns:**
- Redirect URLs from user input
- Open redirects using request data

**Why Medium:** Enables phishing attacks by redirecting users to malicious sites.

**Fixes:**
- Whitelist allowed redirect URLs
- Use relative URLs
- Validate redirect targets

### Missing Input Validation

**Pattern Code:** `medium:missing_validation`

**Patterns:**
- Direct use of request parameters
- User input without sanitization
- Missing type checking

**Why Medium:** Allows injection attacks, unexpected behavior, potential exploits.

**Best Practices:**
- Use input validation libraries (pydantic validators)
- Validate with schemas
- Sanitize all user input
- Use parameterized queries for databases

---

## Low Severity

### Deprecated API Usage

**Pattern Code:** `low:deprecated`

**Patterns:** `subprocess.call` (prefer `subprocess.run`)

**Why Low:** Deprecated APIs may have security issues or be removed in future versions.

### Hardcoded Paths

**Pattern Code:** `low:hardcoded_paths`

**Patterns:** `/home/user`, `C:\Users\username` in code

**Why Low:** Reduces portability, may fail on different systems.

---

## False Positives

The scanner may trigger on patterns that are actually safe. Common false positives include:

1. **Test/example code**: Files containing "example", "test", "placeholder"
2. **Documentation**: Commented examples in docs
3. **Mock data**: Test fixtures and samples
4. **Default values**: Non-sensitive default configurations

Always verify findings manually before taking action.
