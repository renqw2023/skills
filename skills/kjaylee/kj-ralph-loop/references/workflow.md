# Ralph Loop 상세 워크플로우

## 프로젝트 구조

```
project/
├── specs/                    # 요구사항 문서
│   ├── core-feature.md
│   ├── ui-components.md
│   └── api-integration.md
├── IMPLEMENTATION_PLAN.md    # 태스크 리스트 (자동 업데이트)
├── AGENTS.md                 # 빌드/테스트 명령어
└── src/                      # 소스 코드
```

## Phase 1: 요구사항 정의

### 스펙 작성 원칙

**Topic Scope Test:** "And 없이 한 문장"
- ✓ "색상 추출 시스템이 이미지에서 dominant color를 분석한다"
- ✗ "유저 시스템이 인증, 프로필, 결제를 처리한다" → 3개 topic

### 스펙 템플릿

```markdown
# Feature Name

## 목적
[이 기능이 해결하는 문제]

## 요구사항
- [ ] 요구사항 1
- [ ] 요구사항 2

## 수용 기준
- 조건 A일 때 결과 B
- 에러 시 처리 방식

## 기술 제약
- 사용할 라이브러리/프레임워크
- 성능 요구사항
```

## Phase 2: 플래닝

### Gap 분석 프로세스

1. specs/*.md 전체 읽기
2. 현재 src/ 구조 분석
3. 구현 안 된 것 식별
4. 의존성 순서로 정렬

### IMPLEMENTATION_PLAN.md 템플릿

```markdown
# Implementation Plan

## 현재 상태
[프로젝트 현황 요약]

## TODO (우선순위순)

### High Priority
- [ ] 태스크 1 - specs/core-feature.md 참조
- [ ] 태스크 2

### Medium Priority  
- [ ] 태스크 3

### Low Priority
- [ ] 태스크 4

## IN PROGRESS
- [ ] 현재 작업 중인 태스크

## DONE
- [x] 완료된 태스크 (날짜)

## BLOCKED
- [ ] 차단된 태스크 - 이유: [...]

## DISCOVERIES
- 발견한 이슈나 개선점
```

## Phase 3: 빌딩

### 단일 태스크 사이클

```
┌─────────────────────────────────────┐
│ 1. IMPLEMENTATION_PLAN.md 읽기      │
│ 2. 가장 중요한 TODO 선택            │
│ 3. IN PROGRESS로 이동               │
└─────────────┬───────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│ 4. 서브에이전트: specs/* 분석       │
│ 5. 서브에이전트: 관련 src/ 분석     │
│ 6. 서브에이전트: 구현               │
└─────────────┬───────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│ 7. 테스트/린트 실행 (백프레셔)      │
│    - 실패 시 → 수정 후 재시도       │
│    - 성공 시 → 다음 단계            │
└─────────────┬───────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│ 8. IMPLEMENTATION_PLAN.md 업데이트  │
│    - TODO → DONE 이동               │
│    - DISCOVERIES 추가               │
│ 9. 커밋                             │
└─────────────┬───────────────────────┘
              │
              ▼
        [다음 태스크]
```

### 서브에이전트 활용

**언제 spawn 하는가:**
- 파일 분석 (specs, src)
- 코드 구현
- 테스트 실행
- 문서 생성

**메인에서 직접 하는 것:**
- 태스크 선택/우선순위
- 플랜 업데이트
- 커밋 메시지 작성
- 전체 진행 상황 관리

### 백프레셔 설정

AGENTS.md에 명시:
```markdown
## 빌드/테스트 명령어
- 빌드: `npm run build`
- 테스트: `npm test`
- 린트: `npm run lint`
- 타입체크: `npm run typecheck`
```

## 컨텍스트 리셋 타이밍

### 자동 리셋 (권장)
- 3-5개 태스크 완료 후
- 컨텍스트 50% 이상 사용 시
- 에러 반복 시

### 리셋 방법
1. 현재 상태 IMPLEMENTATION_PLAN.md에 기록
2. 새 세션 시작 (또는 sessions_spawn)
3. SKILL.md + IMPLEMENTATION_PLAN.md 로드
4. 이어서 진행

## 트러블슈팅

### Ralph가 방향 잃을 때
1. IMPLEMENTATION_PLAN.md 재생성
2. specs/ 더 구체적으로 작성
3. 백프레셔 강화 (더 많은 테스트)

### 같은 에러 반복할 때
1. AGENTS.md에 "하지 말 것" 추가
2. 관련 유틸리티 코드 먼저 작성
3. specs/에 구체적 예시 추가

### 컨텍스트 부족할 때
1. 서브에이전트 더 적극 활용
2. 태스크 더 작게 쪼개기
3. 불필요한 파일 컨텍스트에서 제거
